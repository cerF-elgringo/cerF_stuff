// --- ensure buttons exist before attaching listeners ---
window.addEventListener('DOMContentLoaded', () => {

  // NORMAL button
  document.getElementById('normal-btn').addEventListener('click', async ()=>{
    selectedMode='NORMAL';
    gibberishMode=false;
    sessionStorage.setItem('glabble_mode','NORMAL');
    sessionStorage.setItem('glabble_hosky_difficulty', hoskyDifficulty||'HARD');
    sessionStorage.removeItem('glabble_restore');
    wordLength=5;
    document.getElementById('mode-select-overlay').style.display='none';
    gameWrapper.style.display='flex';
    requestAnimationFrame(()=>setTimeout(adjustBoardForWordLength,20));
    try {
      const res=await fetch('https://random-word-api.vercel.app/api?words=1&length=5');
      const data=await res.json();
      targetWord=data[0].toUpperCase();
    } catch(e) {
      console.error('normal fetch failed', e);
      targetWord='APPLE';
    }
  });

  // HOSKY button
  document.getElementById('hosky-btn').addEventListener('click', ()=>{
    document.getElementById('mode-select-overlay').style.display='none';
    document.getElementById('hosky-options-overlay').style.display='flex';
  });

  // HOSKY options overlay
  document.getElementById('hosky-options-overlay').addEventListener('click', (ev)=>{
    const btn = ev.target.closest('button');
    if(!btn) return;
    const id = btn.id;

    if(id === 'hosky-cancel'){
      document.getElementById('hosky-options-overlay').style.display='none';
      document.getElementById('mode-select-overlay').style.display='flex';
      return;
    }

    if(id === 'hosky-easy-btn' || id === 'hosky-hard-btn' || id === 'hosky-gib-btn'){
      if(id === 'hosky-easy-btn'){ hoskyDifficulty = 'EASY'; gibberishMode = false; }
      else if(id === 'hosky-hard-btn'){ hoskyDifficulty = 'HARD'; gibberishMode = false; }
      else { hoskyDifficulty = 'GIBBERISH'; gibberishMode = true; }

      sessionStorage.setItem('glabble_hosky_difficulty', hoskyDifficulty);

      // start game
      selectedMode = 'HOSKY';
      sessionStorage.setItem('glabble_mode', selectedMode);
      sessionStorage.removeItem('glabble_restore');
      targetWord = pickHoskyWord(hoskyDifficulty);
      wordLength = targetWord.length;

      document.getElementById('hosky-options-overlay').style.display='none';
      gameWrapper.style.display='flex';
      requestAnimationFrame(()=>setTimeout(adjustBoardForWordLength,20));
      saveGameState();
    }
  });

});
