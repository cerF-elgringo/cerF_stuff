<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GLABDLE</title>
<link href="https://fonts.cdnfonts.com/css/grobold" rel="stylesheet">

<style>
/* Hide scrollbars visually (no visible scrollbars anywhere) */
html, body {
  -ms-overflow-style: none;  /* IE/Edge */
  scrollbar-width: none;     /* Firefox */
}
html::-webkit-scrollbar, body::-webkit-scrollbar {
  display: none;
  width: 0;
  height: 0;
}
* { box-sizing: border-box; margin:0; padding:0; }
html, body {
    min-height: 100%;
    height: 100%;
    width: 100%;
    overflow-x: hidden;
    overflow-y: hidden;          /* <- NEVER show page scrollbars */
    font-family: 'GROBOLD', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;   /* center vertically when content fits */
    padding: 28px;         /* keep a comfortable gap from the viewport edges */
    background-color: black;
    color: #206cd2;
    background-image: url('https://hosky.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2FHosky_1200.9361cc3f.png&w=3840&q=85&dpl=dpl_A35He1TJdeTQghKRghvecRxzGvvJ');
    background-repeat: repeat;
    background-size: 150px 150px;
}

#game-wrapper {
    display: none; /* hidden until mode selected */
    flex-direction: column;
    align-items: center;
    background-color: rgba(0,0,0,0.5);
    min-width: 340px;
    max-width: 90vw;
    padding: 20px;
    border-radius: 10px;

    /* keep centered, do NOT add internal scrollbars */
    max-height: none;
    overflow: visible;
    -webkit-overflow-scrolling: auto;
}
h1 { font-size: 72px; margin-bottom: 20px; color: #206cd2;
    text-shadow: 0 0 5px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00;
}

#game-container {
  display: grid;
  grid-template-rows: repeat(6, auto); /* allow JS to set row heights */
  grid-gap: 10px;
  margin-bottom: 20px;
  width: 100%;
  overflow: visible;
}
.row {
    display: grid;
    grid-gap: 10px;
    justify-content: center; /* center the row when it's narrower than the wrapper */
}
.cell { 
    width: 63px; 
    height: 63px; 
    border: 2px solid #206cd2; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    font-size: 36px; 
    text-transform: uppercase; 
    color: #206cd2; 
    background-color: black; 
    user-select: none; 
    border-radius: 6px; /* slightly rounded corners */
}
.cell.active { border-color: #ffc107; box-shadow: 0 0 10px #ffc107; }
.green { background-color: #206cd2; color: black; }
.yellow { background-color: #ffc107; color: black; }
.gray { background-color: #555; color: black; }
.cell.locked { pointer-events: none; opacity: 0.6; user-select: none; }

#alphabet { display: flex; flex-wrap: wrap; max-width: 420px; justify-content: center; gap: 5px; margin-top: 5px; }
.letter-box { 
    width: 38px; 
    height: 38px; 
    border: 3.5px solid #206cd2; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    text-transform: uppercase; 
    color: #206cd2; 
    font-size: 18px; 
    user-select: none; 
    border-radius: 6px; /* slightly rounded corners */
    background-color: rgba(0, 0, 0, 0.9); /* 75% opaque black */
}

.letter-box:hover {
    background-color: #206cd2; /* bright blue on hover */
    color: black;              /* text contrast */
    transform: scale(1.1);     /* slight grow effect */
    box-shadow: 0 0 8px #206cd2; /* subtle glow */
}
/* Extra spacing for special keys */
#letter-enter {
    margin-right: 12px;  /* default spacing on desktop */
}

#letter-backspace {
    margin-left: 12px;   /* default spacing on desktop */
}

/* Reduce spacing on smaller screens */
@media (max-width: 500px) {
    #letter-enter {
        margin-right: 6px;
    }
    #letter-backspace {
        margin-left: 6px;
    }
}
/* Special keys slightly bigger */
#letter-enter, #letter-backspace {
    width: 80px;      /* wider than normal letter boxes (38px) */
    height: 38px;     /* same height as letters */
    border-radius: 6px; /* same rounding as letters */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s ease;
}

/* ENTER key styling */
#letter-enter {
    margin-right: 12px;  /* spacing to next key */
    background-color: #00ff00;  /* keep your current color */
    color: black;
}

#letter-enter:hover {
    background-color: #0000ff;  /* hover effect */
    transform: scale(1.05);
}

/* BACKSPACE key styling */
#letter-backspace {
    margin-left: 12px;       /* spacing from previous key */
    background-color: black;  /* same as letter boxes */
    border: 3.5px solid #206cd2; /* match letter boxes border */
    color: #206cd2;          /* same as letters */
    font-weight: bold;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 6px;      /* same rounding as letters */
    transition: all 0.2s ease;
}

#letter-backspace:hover {
    background-color: #206cd2; /* bright blue on hover like letters */
    color: black;              /* text contrast */
    transform: scale(1.05);
    box-shadow: 0 0 8px #206cd2; /* subtle glow like letters */
}

/* Reduce spacing on smaller screens */
@media (max-width: 500px) {
    #letter-enter, #letter-backspace {
        width: 60px; /* slightly smaller on mobile */
    }
    #letter-enter { margin-right: 6px; }
    #letter-backspace { margin-left: 6px; }
}
#mobile-input { position: absolute; opacity: 0; width: 1px; height: 1px; }

#win-gif-container, #lose-gif-container { display: none; opacity: 0; transition: opacity 1s ease; position: fixed; top:50%; left:50%; transform: translate(-50%, -50%); z-index: 9999; width: 450px; max-width: 90%; }

#win-message, #lose-message { 
    display: none; 
    position: fixed; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%) rotate(0deg);
    font-size: 84px; 
    line-height: 1.1;
    text-align: center; 
    z-index: 9998; 
    background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); 
    background-size: 300% 100%; 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
    filter: drop-shadow(0 0 6px #ff69b4) drop-shadow(0 0 12px #ff69b4);
    animation: gradientMove 0.8s linear infinite alternate, wiggle 0.2s ease-in-out infinite alternate;
    overflow: visible;
}

/* Rainbow gradient movement */
@keyframes gradientMove { 
    0% { background-position: 0% 50%; } 
    50% { background-position: 150% 50%; } 
    100% { background-position: 300% 50%; } 
}

@keyframes revealLetter {
    0% {
        transform: scale(0.9);
        opacity: 0.7;
    }
    50% {
        transform: scale(1.2);
        opacity: 1;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* Quick wiggle rotation */
@keyframes wiggle {
    0% { transform: translate(-50%, -50%) rotate(-2deg); }
    50% { transform: translate(-50%, -50%) rotate(2deg); }
    100% { transform: translate(-50%, -50%) rotate(-2deg); }
}
.lose-poo { position: fixed; top: 10px; font-size: 180px; display: none; z-index: 10000; user-select: none; pointer-events: none; }
#lose-poo-left { left: 20px; }
#lose-poo-right { right: 20px; }
.falling-poo { position: absolute; pointer-events: none; user-select: none; animation-name: fall; animation-timing-function: linear; }
@keyframes fall { 0% { transform: translateY(-200px) rotate(0deg); } 100% { transform: translateY(100vh) rotate(720deg); } }

#games-counter { position: fixed; top: 10px; right: 10px; font-size: 14px; color: #206cd2; z-index: 10001; font-family: 'GROBOLD', sans-serif; }
#games-counter {
    display: none !important;  /* hides the total games counter */
}
/* MODE BUTTONS */
#mode-select-overlay {
    position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); z-index: 100000;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    gap: 20px;
}
.mode-btn {
    font-family:'GROBOLD', sans-serif; 
    font-size:32px; 
    color:#206cd2; 
    background:black; 
    border:2px solid #206cd2; 
    padding:15px 30px; 
    cursor:pointer;
    text-transform:uppercase; 
    box-shadow:0 0 0 #ff9900; 
    transition:0.3s;
    border-radius: 8px; /* <- new, matches cells/keyboard rounding */
}
.mode-btn:hover { box-shadow:0 0 15px #ff9900; color:#ffc107; border-color:#ffc107; }
.mode-title {
    font-size: 48px;
    color: #cccccc; /* light grey text */
    text-shadow: 
        0 0 2px #888888,   /* subtle inner glow */
        0 0 6px #666666;   /* soft outer glow */
}
.enter-box {
    width: 80px;        /* elongated to fit "ENTER" */
    height: 36px;       /* same height as other letters */
    background-color: #00ff00;
    color: black;
    font-weight: bold;
    border-radius: 6px; /* same as letters */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 14px;    /* slightly smaller so "ENTER" fits */
    transition: all 0.2s ease;
}

.enter-box:hover {
    background-color: #0000FF;
    transform: scale(1.05);  /* subtle hover scale */
}
@media (max-width:500px){.mode-btn{font-size:24px;padding:10px 20px}.mode-title{font-size:32px}}

/* Adjust GLABDLE title on small screens */
@media (max-width: 500px) {
    #mode-select-overlay h1,
    #game-wrapper h1 {
        font-size: 48px;       /* smaller title on mobile */
        margin-top: 10px;      /* add some spacing from top */
    }
}

</style>
</head>
<body>

<div id="mode-select-overlay">
    <h1 style="font-size:72px; color:#206cd2; text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00; margin-bottom:20px;">GLABDLE</h1>
    <h2 class="mode-title">Choose Mode</h2>
    <div style="display:flex; gap:20px;">
        <button class="mode-btn" id="hosky-btn" type="button">HOSKY Words</button>
        <button class="mode-btn" id="normal-btn" type="button">NORMAL Words</button>
    </div>
</div>
<div id="correct-word-display" style="
    position: fixed;
    top: 20px;
    right: 10px;
    font-size: 24px;
    color: orange;
    font-family: 'GROBOLD', sans-serif;
    z-index: 10002;
    display: none;
">
    WORD
</div>
<div id="game-wrapper">
    <div id="lose-poo-left" class="lose-poo">ðŸ’©</div>
    <div id="lose-poo-right" class="lose-poo">ðŸ’©</div>
    <h1>GLABDLE</h1>
    <div id="game-container">
        <div class="row" id="row0"></div>
        <div class="row" id="row1"></div>
        <div class="row" id="row2"></div>
        <div class="row" id="row3"></div>
        <div class="row" id="row4"></div>
        <div class="row" id="row5"></div>
    </div>
    <div id="alphabet"></div>
</div>

<input type="text" id="mobile-input" maxlength="5" />

<div id="win-gif-container"></div>
<div id="lose-gif-container"></div>

<div id="win-message">GOOD JOB IDJIOT</div>
<div id="lose-message">TRY AGAIN IDJIOT</div>

<div id="games-counter">Total games submitted: <span id="games-count">0</span></div>

<script type="text/javascript" async src="https://tenor.com/embed.js"></script>

<script>

// Detect if page is loaded normally (not via back/forward)
window.addEventListener('load', () => {
    try {
        const nav = performance.getEntriesByType("navigation")[0];
        if(!nav || !nav.type.includes("back_forward")){
            // Normal refresh â†’ clear saved game
            sessionStorage.removeItem('glabble_state');
            document.getElementById('mode-select-overlay').style.display = 'flex';
            gameWrapper.style.display = 'none';
        }
    } catch (e) {
        // fallback - show overlay
        document.getElementById('mode-select-overlay').style.display = 'flex';
        gameWrapper.style.display = 'none';
    }
});

// --- CLEAN PAGESHOW HANDLER (mobile keyboard hidden on return) ---
window.addEventListener('pageshow', (event) => {
    const savedState = sessionStorage.getItem('glabble_state');
    if (!savedState) return;

    const state = JSON.parse(savedState);

    // Hide mode overlay & show game
    document.getElementById('mode-select-overlay').style.display = 'none';
    gameWrapper.style.display = 'flex';

    // Load saved board & state
    loadGameState();

    // Reset ephemeral UI
    document.getElementById('win-message').style.display = 'none';
    document.getElementById('lose-message').style.display = 'none';
    document.getElementById('win-gif-container').style.opacity = 0;
    document.getElementById('win-gif-container').style.display = 'none';
    document.getElementById('lose-gif-container').style.opacity = 0;
    document.getElementById('lose-gif-container').style.display = 'none';
    document.getElementById('lose-poo-left').style.display = 'none';
    document.getElementById('lose-poo-right').style.display = 'none';
    setBlur(false);

    // Hide mobile keyboard
    mobileInput.blur();

    // Determine if last guess was a win
    const lastRow = state.board[state.currentRow > 0 ? state.currentRow - 1 : 0];
    const won = lastRow.every(c => c.classes.includes('green'));

    // Show appropriate buttons
    setTimeout(() => {
        if (won) {
            addWinButtons();
        } else if (state.gameOver) {
            addLoseButtons();
        }
    }, 500);

    // Adjust board sizing now that wrapper is visible and state is loaded
    requestAnimationFrame(() => setTimeout(adjustBoardForWordLength, 20));
});

// --- GAME MODE VARIABLES ---
let selectedMode = 'HOSKY'; // default
let targetWord = "HOSKY";   // must be let, can change for NORMAL
let wordLength = 5;         // dynamic: will match targetWord.length when mode chosen
const hoskyPool = ["CHARLES","JKRO","JKROBAR","ALPHA","DANKSY","TBLH","THEBIGLEHOSKY",
    "RADIOACTIVE","GLAB","ZERO","NOOB","DEGEN","DEGENERAL","DISCORD",
    "CABAL","WEN","MOON","RUG","WOOF","RUGPOOL","WENWEBSITE","WENPDF",
    "CURRYWURST","WOOSHIE","SCHMACK","BOSSKY","BIGBOSSKY"];
const extraWords = ["HOSKY","GLABS"];
const triggerWords = ["SAYOS","VEGAS","JINXY","CERFY","GLABS"];
const gameWrapper = document.getElementById('game-wrapper');
const winningGifs = ["4540374823853696704","24111898","24123953","10534076","7551288617603856546"];
async function isValidWord(word){
// ALWAYS allow the secret word
    if (word.toUpperCase() === targetWord.toUpperCase()) {
        return true;
    }
    word = word.toLowerCase();
    if(extraWords.includes(word.toUpperCase())) return true;  // allow custom words like HOSKY, GLABS
    try {
        const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
        return res.ok;  // âœ… returns true if word exists in dictionary
    } catch(e) {
        return false; // API failed â†’ treat as invalid
    }
}
const profaneWords = ["fuck","shit","bitch","bastard","dick","cunt","asshole","nigger","faggot","slut","whore","cock","pussy","douche"];
function checkProfanity(word){return profaneWords.some(p=>word.toLowerCase().includes(p));}

// Adjust the board to current wordLength: recreate rows/cells and set mobile maxlength
async function adjustBoardForWordLength(){
    const mi = document.getElementById('mobile-input');
    if(mi) mi.maxLength = wordLength;

    const wrapper = document.getElementById('game-wrapper');
    const container = document.getElementById('game-container');
    const gap = 10; // matches CSS grid-gap
    const totalGapsH = (Math.max(1, wordLength) - 1) * gap;
    const totalGapsV = (6 - 1) * gap; // vertical gaps between rows

    // If wrapper is hidden, retry shortly (measurements would be wrong)
    const wrapperStyle = wrapper ? getComputedStyle(wrapper) : null;
    if (!wrapper || wrapperStyle.display === 'none' || wrapper.clientWidth < 20) {
        requestAnimationFrame(() => setTimeout(adjustBoardForWordLength, 40));
        return;
    }

    // Wait for fonts to be ready (if supported) so title height is accurate
    try {
        if (document.fonts && document.fonts.status !== 'loaded') {
            await document.fonts.ready;
            await new Promise(res => setTimeout(res, 20));
        }
    } catch (e) {
        // ignore
    }

    // compute body padding (we need to respect the page padding)
    const bodyStyle = getComputedStyle(document.body);
    const bodyPaddingTop = parseFloat(bodyStyle.paddingTop || 0);
    const bodyPaddingBottom = parseFloat(bodyStyle.paddingBottom || 0);

    // Measure available width inside the wrapper (clientWidth respects wrapper padding)
    const wrapperWidth = Math.max(220, wrapper.clientWidth || Math.floor(window.innerWidth * 0.9));
    const availableWidth = Math.max(160, wrapperWidth);

    // Measure title + keyboard heights (accurate measured height)
    const titleEl = wrapper.querySelector('h1');
    const alphabetEl = document.getElementById('alphabet');
    const titleH = titleEl ? Math.ceil(titleEl.getBoundingClientRect().height) : 0;
    const keyboardH = alphabetEl ? Math.ceil(alphabetEl.getBoundingClientRect().height) : 72; // fallback

    // breathing room for margins and overlays
    const verticalReserve = 40; // px (smaller to prefer fitting)

    // usable height for the six rows: viewport minus body paddings, title, keyboard and reserve
    const usableHeight = Math.max(120, window.innerHeight - bodyPaddingTop - bodyPaddingBottom - titleH - keyboardH - verticalReserve);

    // compute constraints
    const cellByWidth = Math.floor((availableWidth - totalGapsH) / Math.max(1, wordLength));
    const cellByHeight = Math.floor((usableHeight - totalGapsV) / 6);

    // limits: never bigger than original design, but allow small as last resort
    const ORIGINAL_CELL = 63;
    const MIN_CELL = 14;      // keep letters still readable while ensuring fit

    // choose smallest constraint so everything fits
    let cellSize = Math.min(cellByWidth, cellByHeight, ORIGINAL_CELL);
    if (cellSize < MIN_CELL) cellSize = MIN_CELL;

    // final precaution: if computed layout is still taller than viewport (very small screens),
    // shrink further proportionally
    const totalBoardHeight = (cellSize * 6) + totalGapsV + titleH + keyboardH + verticalReserve + bodyPaddingTop + bodyPaddingBottom;
    if (totalBoardHeight > window.innerHeight) {
        const availableForCells = Math.max((window.innerHeight - titleH - keyboardH - verticalReserve - totalGapsV - bodyPaddingTop - bodyPaddingBottom), MIN_CELL * 6);
        const newCell = Math.floor(availableForCells / 6);
        cellSize = Math.max(MIN_CELL, Math.min(cellSize, newCell));
    }

    // font size: scale but do not exceed original
    const fontSize = Math.min(36, Math.max(10, Math.floor(cellSize * 0.6)));

    // ensure no forced internal scrollbars; center content
    container.style.overflowX = 'hidden';
    container.style.minWidth = '';
    container.style.justifyContent = 'center';

    // set container row heights so rows don't overlap vertically
    container.style.gridTemplateRows = `repeat(6, ${cellSize}px)`;

    // recreate cells for each row using the calculated sizes
    for(let r=0;r<6;r++){
        const row = document.getElementById(`row${r}`);
        if(!row) continue;
        row.style.gridTemplateColumns = `repeat(${wordLength}, ${cellSize}px)`;
        row.style.height = `${cellSize}px`;
        row.innerHTML = '';
        createCells(row, r, cellSize, fontSize);
        row.style.justifyContent = 'center';
    }

    updateActiveCell();
}

// --- MODE BUTTONS LOGIC (BOARD VISIBLE AFTER CLICK) ---
document.getElementById('hosky-btn').addEventListener('click', () => {
    selectedMode = 'HOSKY';
    // pick a hosky target word from pool
    const chosen = hoskyPool[Math.floor(Math.random() * hoskyPool.length)];
    targetWord = chosen.toUpperCase();
    wordLength = targetWord.length;

    // show UI first, THEN measure/adjust (ensures measurements are correct)
    document.getElementById('mode-select-overlay').style.display = 'none';
    gameWrapper.style.display = 'flex';
    requestAnimationFrame(() => setTimeout(adjustBoardForWordLength, 20));
    saveGameState();
});

document.getElementById('normal-btn').addEventListener('click', async () => {
    selectedMode = 'NORMAL';
    // normal mode is always 5 letters
    wordLength = 5;

    // show UI first, THEN measure/adjust
    document.getElementById('mode-select-overlay').style.display = 'none';
    gameWrapper.style.display = 'flex';
    requestAnimationFrame(() => setTimeout(adjustBoardForWordLength, 20));

    try {
        const res = await fetch('https://random-word-api.vercel.app/api?words=1&length=5');
        const data = await res.json();
        targetWord = data[0].toUpperCase();
        console.log("NORMAL target word:", targetWord);

        // Optional debug display
        const debugDiv = document.getElementById('debug-word');
        if(debugDiv){
            debugDiv.style.display = 'block';
            document.getElementById('debug-word-text').textContent = targetWord;
        }

    } catch(err) {
        console.error("Error fetching normal word:", err);
        targetWord = "APPLE"; // fallback
    }
});


// --- CREATE CELLS ---
function createCells(row,rowIndex, cellSize = 63, fontSize = 36){
    for(let i=0;i<wordLength;i++){
        const cell = document.createElement('div');
        cell.classList.add('cell');
        // apply inline size adjustments so different lengths look OK
        cell.style.width = `${cellSize}px`;
        cell.style.height = `${cellSize}px`;
        cell.style.fontSize = `${fontSize}px`;
        row.appendChild(cell);
        cell.addEventListener('click', ()=>{if(rowIndex===currentRow && !gameOver){currentCol=i;updateActiveCell(); if(window.innerWidth <= 500) document.getElementById('mobile-input').focus(); row.scrollIntoView({behavior:'smooth', block:'center'});}});
    }
}
// initial creation: default 5-letter board
for(let i=0;i<6;i++) createCells(document.getElementById(`row${i}`), i);

// --- ALPHABET + ENTER + BACKSPACE ---
const alphabetContainer = document.getElementById('alphabet');

// create normal letters
for (let l of "ABCDEFGHIJKLMNOPQRSTUVWXYZ") {
    const box = document.createElement('div');
    box.classList.add('letter-box');
    box.id = `letter-${l}`;
    box.textContent = l;
    alphabetContainer.appendChild(box);
}

// ENTER key
const enterBox = document.createElement('div');
enterBox.classList.add('letter-box', 'enter-box');
enterBox.id = "letter-enter"; // unique ID
enterBox.textContent = 'ENTER';
alphabetContainer.appendChild(enterBox);

// BACKSPACE key
const backBox = document.createElement('div');
backBox.classList.add('letter-box', 'enter-box'); // same size as ENTER key
backBox.id = "letter-backspace";
backBox.textContent = 'back';  // standard back arrow symbol
alphabetContainer.appendChild(backBox);

// --- CLICK HANDLER ---
document.querySelectorAll('.letter-box').forEach(box => {
    box.addEventListener('click', () => {
        const letter = box.textContent;

        if(box.id === "letter-enter"){
            handleKey('Enter');
        } else if(box.id === "letter-backspace"){
            handleKey('Backspace');
        } else {
            handleKey(letter);
        }
    });
});
// --- GAME FUNCTIONS ---
function updateAlphabet(letter,state){
    const box=document.getElementById(`letter-${letter}`);
    if(!box) return;
    if(state==='green'){box.style.backgroundColor='#206cd2'; box.style.color='black';}
    else if(state==='yellow'){box.style.backgroundColor='#ffc107'; box.style.color='black';}
    else{box.style.backgroundColor='#555'; box.style.color='black';}
}

function updateActiveCell(){
    document.querySelectorAll('.cell').forEach(c=>c.classList.remove('active'));
    const cells=document.getElementById(`row${currentRow}`).querySelectorAll('.cell');
    if(currentCol < 0) currentCol = 0;
    if(currentCol >= wordLength) currentCol = wordLength - 1;
    if(currentCol<wordLength) cells[currentCol].classList.add('active');
    if(window.innerWidth <= 500){setTimeout(()=>document.getElementById(`row${currentRow}`).scrollIntoView({behavior:'smooth', block:'center'}),50);}
}

function setBlur(enable){gameWrapper.style.filter=enable?'blur(5px)':'none';}
function fadeIn(el){el.style.display='block';requestAnimationFrame(()=>el.style.opacity='1');}
function fadeOut(el){el.style.opacity='0';setTimeout(()=>el.style.display='none',1000);}
function startPoopRain(count=16){for(let i=0;i<count;i++){const poop=document.createElement('div');poop.classList.add('falling-poo');poop.textContent='ðŸ’©';poop.style.left=Math.random()*(window.innerWidth-100)+'px';poop.style.fontSize=(110+Math.random()*120)+'px';poop.style.animationDuration=(10+Math.random()*6)+'s';document.body.appendChild(poop);poop.addEventListener('animationend',()=>poop.remove());}}
function startLosePoopRain(count=12){for(let i=0;i<count;i++){const poop=document.createElement('div');poop.classList.add('falling-poo');poop.textContent='ðŸ’©';poop.style.left=Math.random()*(window.innerWidth-80)+'px';poop.style.fontSize=(60+Math.random()*80)+'px';poop.style.animationDuration=(5+Math.random()*5)+'s';document.body.appendChild(poop);poop.addEventListener('animationend',()=>poop.remove());}}

// --- SESSION STORAGE ---
function saveGameState(){
    const state={currentRow,currentCol,board:[],gameOver};
    for(let r=0;r<6;r++){
        const cells=document.getElementById(`row${r}`).querySelectorAll('.cell');
        state.board.push(Array.from(cells).map(c=>({letter:c.textContent,classes:c.className})));
    }
    const alphabetState={};
    "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l=>{const box=document.getElementById(`letter-${l}`); if(box) alphabetState[l]=box.style.backgroundColor;});
    state.alphabet = alphabetState;
    sessionStorage.setItem('glabble_state',JSON.stringify(state));
    // persist current mode too
    sessionStorage.setItem('glabble_mode', selectedMode);
}

function loadGameState(){
    const stateRaw = sessionStorage.getItem('glabble_state');
    if(!stateRaw) return;
    const state = JSON.parse(stateRaw);

    // Restore selected mode from saved state if present; fallback to separate key, then keep current selectedMode
    if (state.selectedMode) {
        selectedMode = state.selectedMode;
    } else {
        const persistedMode = sessionStorage.getItem('glabble_mode');
        if (persistedMode === 'NORMAL' || persistedMode === 'HOSKY') selectedMode = persistedMode;
    }

    // If saved board uses a different length, restore that length
    if(state.board && state.board[0] && state.board[0].length){
        wordLength = state.board[0].length;
        adjustBoardForWordLength();
    }

    currentRow = state.currentRow;
    currentCol = state.currentCol;
    gameOver = state.gameOver || false;

    for(let r=0;r<6;r++){
        const cells = document.getElementById(`row${r}`).querySelectorAll('.cell');
        if(!state.board[r]) continue;
        cells.forEach((c,i) => {
            if(state.board[r][i]){
                c.textContent = state.board[r][i].letter;
                c.className = state.board[r][i].classes;
                // ensure base 'cell' class present
                if(!c.classList.contains('cell')) c.classList.add('cell');
            } else {
                c.textContent = '';
                c.className = 'cell';
            }
        });
    }

    if(state.alphabet){
        for(let l in state.alphabet){
            const box = document.getElementById(`letter-${l}`);
            if(box) box.style.backgroundColor = state.alphabet[l];
        }
    }

    updateActiveCell();
    if(gameOver) mobileInput.blur();
}

// --- INPUT ---
const mobileInput=document.getElementById('mobile-input');
let currentRow=0,currentCol=0,gameOver=false;

mobileInput.addEventListener('input',e=>{const value=e.target.value.toUpperCase();if(value.length>0){handleKey(value[value.length-1]);mobileInput.value='';}});
document.addEventListener('keydown',e=>handleKey(e.key));
if(window.innerWidth<=500){window.addEventListener('load',()=>{mobileInput.focus(); setTimeout(()=>document.getElementById(`row${currentRow}`)?.scrollIntoView({behavior:'smooth', block:'center'}),50);});}

// --- TOTAL GAMES COUNTER ---
let totalGames=parseInt(localStorage.getItem('glabble_totalGames')||'0');
document.getElementById('games-count').textContent=totalGames;


// --- HANDLE KEYS ---
async function handleKey(key){
    if(gameOver) return;
    const row = document.getElementById(`row${currentRow}`);
    const cells = row.querySelectorAll('.cell');

    if(key==='Backspace'){
        if(cells[currentCol].textContent===""){if(currentCol>0) currentCol--;cells[currentCol].textContent="";}else{cells[currentCol].textContent="";}
        updateActiveCell(); saveGameState(); return;
    }
    if(key==='Enter'){
        if(Array.from(cells).every(c=>c.textContent!=="")){
            const guess=Array.from(cells).map(c=>c.textContent).join('').toUpperCase();
            await processGuess(guess);
        }
        return;
    }
    if(/^[a-zA-Z]$/.test(key)){
        if(currentCol<wordLength){cells[currentCol].textContent=key.toUpperCase();if(currentCol<wordLength-1) currentCol++; updateActiveCell(); saveGameState();}
    }
}

// --- PROCESS GUESS ---
const redirects={
    "SAYOS":["https://en.wikipedia.org/wiki/Burbot","https://www.mazda.com/en/","https://www.youtube.com/watch?v=K1fyza5BN-0","https://www.hkmaps.hk/viewer.html","https://www.youtube.com/watch?v=YJFNdIJnrHY","https://www.spanishdict.com/translate/sayos"],
    "VEGAS":["https://x.com/HoskyDevVegas/status/1947043091216494826","https://www.dreamvacations.com/vacation/destinations/all","https://www.youtube.com/watch?v=1DUaR0zBGgQ","https://www.christinascucina.com/beans-on-toast-the-proper-british-way-recipe-by-a-brit/","https://www.urbandictionary.com/define.php?term=foo-foo%20drink"],
    "JINXY":["https://en.wikipedia.org/wiki/Flat_bean","https://www.reddit.com/r/Netherlands/comments/1ghutfw/what_are_some_crucial_traditional_dutch/","https://www.thedutchtable.com/2010/10/bitterballen-dutch-deep-fried-gravy.html"],
    "CERFY":["https://www.youtube.com/watch?v=aBquLj4kLxQ","https://www.youtube.com/watch?v=4npQAvzrND0","https://www.imdb.com/title/tt1990216/","https://www.youtube.com/watch?v=_ngkB44qaQw"],
    "GLABS":["https://www.jpg.store/collection/hoskycashgrab?tab=items&filters=eyJmdXIiOlsiR29sZUVuIExhYnJhZG9yIl19"]
};

async function processGuess(guess){
    const row = document.getElementById(`row${currentRow}`);
    const cells = row.querySelectorAll('.cell');

    // âœ… Check if guess is valid
    if(!triggerWords.includes(guess) && !(await isValidWord(guess))){
    alert("THAT AIN'T NO REAL WERD, IDJIOT!");
    // CLEAR THE CURRENT ROW
    const cells = document.getElementById(`row${currentRow}`).querySelectorAll('.cell');
    cells.forEach(c => c.textContent = "");
    currentCol = 0;
    updateActiveCell();
    saveGameState();
    return;
}

    // --- Prepare counts for correct coloring ---
    const targetLetters = targetWord.split('');
    const guessLetters = guess.split('');
    const letterCounts = {}; // track remaining letters for yellow check

    targetLetters.forEach(l => {
        letterCounts[l] = (letterCounts[l] || 0) + 1;
    });

    // --- First pass: mark greens ---
    const results = Array(wordLength).fill('gray');
    for(let i=0; i<wordLength; i++){
        if(guessLetters[i] === targetLetters[i]){
            results[i] = 'green';
            letterCounts[guessLetters[i]]--;
        }
    }

    // --- Second pass: mark yellows ---
    for(let i=0; i<wordLength; i++){
        if(results[i] === 'gray' && letterCounts[guessLetters[i]] > 0){
            results[i] = 'yellow';
            letterCounts[guessLetters[i]]--;
        }
    }

    // --- Apply colors to cells & alphabet ---
    for(let i=0; i<wordLength; i++){
    cells[i].classList.remove('green','yellow','gray');
    cells[i].classList.add(results[i]);
    updateAlphabet(cells[i].textContent, results[i]);
    
    // add a small staggered delay per letter
    cells[i].style.animation = `revealLetter 0.6s ease forwards ${i*0.15}s`; 
    cells[i].addEventListener('animationend', () => { cells[i].style.animation = ''; }, { once: true });
}

    cells.forEach(c => c.classList.add('locked'));
    saveGameState();

    // --- Check win ---
    if(guess === targetWord){
    gameOver = true; 
    mobileInput.blur(); 
    saveGameState();

    // Delay everything (blur + animations) so squares reveal first
    setTimeout(() => {
        setBlur(true);                 // move blur inside delay
        showWinningGif(); 
        startPoopRain(80);

        setTimeout(() => { 
    fadeOut(document.getElementById('win-gif-container')); 
    const winMsg = document.getElementById('win-message');
    winMsg.style.display='block'; 
      // <-- add this here
}, 4000);


        setTimeout(() => { 
            window.location.href="https://hosky.io"; 
        }, 8000);

    }, 800); // 0.8s delay
    return;
}

    // --- Check lose ---
    if(currentRow === 5){
        gameOver = true; const correctDisplay = document.getElementById('correct-word-display');
correctDisplay.textContent = targetWord.toUpperCase();
correctDisplay.style.display = 'block'; setBlur(true); mobileInput.blur(); saveGameState();
        document.getElementById('lose-poo-left').style.display='block';
        document.getElementById('lose-poo-right').style.display='block';
        startLosePoopRain(40);
        const loseGifs=["6289320449545116130","24576363","5408039","1639610178022128587","1514012758219765433"];
        const gifContainer=document.getElementById('lose-gif-container');
        const randomId=loseGifs[Math.floor(Math.random()*loseGifs.length)];
        gifContainer.innerHTML="";
        const embedDiv=document.createElement("div");
        embedDiv.className="tenor-gif-embed";
        embedDiv.setAttribute("data-postid",randomId);
        embedDiv.setAttribute("data-share-method","host");
        embedDiv.setAttribute("data-aspect-ratio","1");
        embedDiv.setAttribute("data-width","100%");
        gifContainer.appendChild(embedDiv);
        const script=document.createElement("script"); 
        script.type="text/javascript"; 
        script.async=true; 
        script.src="https://tenor.com/embed.js"; 
        gifContainer.appendChild(script);
        fadeIn(gifContainer);
        setTimeout(() => { fadeOut(gifContainer); document.getElementById('lose-message').style.display='block'; }, 4000);
        setTimeout(() => { window.location.href="https://hosky.io"; }, 8000);
        return;
    }

    // --- Trigger & Profanity ---
    if(checkProfanity(guess)){
        currentRow++; currentCol=0; updateActiveCell(); saveGameState();
        window.open("https://www.reddit.com/r/Rants/comments/p1vrsr/when_people_say_keep_it_pg_do_they_mean_keep_it/", '_blank');
        return;
    }

    if(triggerWords.includes(guess)){
        currentRow++; currentCol=0; updateActiveCell(); saveGameState();
        const links = redirects[guess];
        const randomLink = links[Math.floor(Math.random() * links.length)];
        window.open(randomLink, '_blank');
        return;
    }

    // --- Next row ---
    currentRow++; currentCol=0; updateActiveCell(); saveGameState();
}

// --- SHOW WIN GIF ---
function showWinningGif(){
    const gifContainer=document.getElementById('win-gif-container');
    const randomId=winningGifs[Math.floor(Math.random()*winningGifs.length)];
    gifContainer.innerHTML="";
    const embedDiv=document.createElement('div');
    embedDiv.className="tenor-gif-embed";
    embedDiv.setAttribute("data-postid",randomId);
    embedDiv.setAttribute("data-share-method","host");
    embedDiv.setAttribute("data-aspect-ratio","1");
    embedDiv.setAttribute("data-width","100%");
    gifContainer.appendChild(embedDiv);
    const script=document.createElement("script"); script.type="text/javascript"; script.async=true; script.src="https://tenor.com/embed.js"; gifContainer.appendChild(script);
    fadeIn(gifContainer);
}

updateActiveCell();
// --- RESTORE SAVED GAME ON PAGE LOAD ---
window.addEventListener('load', () => {
    const savedState = sessionStorage.getItem('glabble_state');
    if(savedState){
        document.getElementById('mode-select-overlay').style.display = 'none';
        gameWrapper.style.display = 'flex';
        loadGameState();

        // ensure we size after layout settles
        requestAnimationFrame(() => setTimeout(adjustBoardForWordLength, 20));

        if(window.innerWidth <= 500 && !gameOver){ // <-- only focus if game NOT over
            mobileInput.focus();
            setTimeout(()=>document.getElementById(`row${currentRow}`)?.scrollIntoView({behavior:'smooth', block:'center'}),50);
        }
    } else {
        // No saved state: ensure overlay is visible (already handled above) and sizing stays default
    }
});

// Debounce helper
function debounce(fn, wait = 120) {
  let t;
  return function(...args) {
    clearTimeout(t);
    t = setTimeout(() => fn.apply(this, args), wait);
  };
}

// Debounced adjust on resize/orientation/pageshow
const debouncedAdjust = debounce(() => {
  requestAnimationFrame(() => adjustBoardForWordLength());
}, 120);

window.addEventListener('resize', debouncedAdjust);
window.addEventListener('orientationchange', debouncedAdjust);
window.addEventListener('pageshow', debouncedAdjust);

// Ensure initial sizing once fonts/layout are ready
if (document.fonts && document.fonts.ready) {
  document.fonts.ready.then(() => setTimeout(adjustBoardForWordLength, 40)).catch(()=>setTimeout(adjustBoardForWordLength,40));
} else {
  setTimeout(adjustBoardForWordLength,40);
}

// --- LOSE BUTTONS ---
// --- LOSE BUTTONS ---
function addLoseButtons() {
    // Remove existing buttons if any
    const existing = document.getElementById('lose-buttons-container');
    if (existing) existing.remove();

    const container = document.createElement('div');
    container.id = 'lose-buttons-container';
    container.style.position = 'fixed';
    container.style.bottom = '50px';
    container.style.left = '50%';
    container.style.transform = 'translateX(-50%)';
    container.style.display = 'flex';
    container.style.flexDirection = 'row';
    container.style.justifyContent = 'center';
    container.style.alignItems = 'center';
    container.style.gap = '15px';
    container.style.flexWrap = 'wrap';
    container.style.maxWidth = '90%';
    container.style.zIndex = '10005';

    function createButton(text, onClick) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = text;
        btn.style.fontFamily = 'GROBOLD, sans-serif';
        btn.style.fontSize = '15px';
        btn.style.padding = '10px 20px';
        btn.style.cursor = 'pointer';
        btn.style.borderRadius = '6px';
        btn.style.border = '2px solid #206cd2';
        btn.style.backgroundColor = '#ffa500';
        btn.style.color = 'black';
        btn.style.minWidth = '140px';
        btn.style.maxWidth = '180px';
        btn.style.flex = '1 1 auto';

        btn.addEventListener('mouseover', () => {
            btn.style.backgroundColor = '#206cd2';
            btn.style.color = 'black';
        });
        btn.addEventListener('mouseout', () => {
            btn.style.backgroundColor = '#ffa500';
            btn.style.color = 'black';
        });
        btn.addEventListener('click', onClick);
        return btn;
    }

    // Prefer the current in-memory mode first, fallback to persisted session value
    const persistedModeLabel = sessionStorage.getItem('glabble_mode');
    const defaultModeForLabel = (selectedMode === 'HOSKY' || selectedMode === 'NORMAL') ? selectedMode
        : (persistedModeLabel === 'HOSKY' || persistedModeLabel === 'NORMAL') ? persistedModeLabel
        : 'HOSKY';
    const newBtnLabel = (defaultModeForLabel === 'HOSKY') ? 'NEW HOSKY MODE GAME' : 'NEW WORD';

    const newWordBtn = createButton(newBtnLabel, () => {
        container.remove();
        currentRow = 0; currentCol = 0; gameOver = false;
        document.getElementById('lose-message').style.display = 'none';
        document.getElementById('correct-word-display').style.display = 'none';
        setBlur(false);

        // clear board cells and classes
        for(let r=0;r<6;r++){
            const cells = document.getElementById(`row${r}`).querySelectorAll('.cell');
            cells.forEach(c => { c.textContent=''; c.className='cell'; });
        }
        // reset keyboard colors
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l=>{
            const box = document.getElementById(`letter-${l}`);
            if(box){ box.style.backgroundColor=''; box.style.color='#206cd2'; }
        });

        // Determine active mode (prefer in-memory selectedMode, fallback persisted)
        const persisted = sessionStorage.getItem('glabble_mode');
        const modeToUse = (selectedMode === 'HOSKY' || selectedMode === 'NORMAL') ? selectedMode
            : (persisted === 'HOSKY' || persisted === 'NORMAL') ? persisted
            : 'HOSKY';

        // Persist the mode explicitly and set selectedMode
        sessionStorage.setItem('glabble_mode', modeToUse);
        selectedMode = modeToUse;

        if(modeToUse === 'NORMAL'){
            // NORMAL: fetch 5-letter word
            fetch('https://random-word-api.vercel.app/api?words=1&length=5')
            .then(res=>res.json())
            .then(data=>{
                targetWord = data[0].toUpperCase();
                wordLength = 5;
                adjustBoardForWordLength();
                saveGameState();
            })
            .catch(()=>{
                targetWord = "APPLE";
                wordLength = 5;
                adjustBoardForWordLength();
                saveGameState();
            });
        } else {
            // HOSKY: pick from pool
            const chosen = hoskyPool[Math.floor(Math.random() * hoskyPool.length)];
            targetWord = chosen.toUpperCase();
            wordLength = targetWord.length;
            adjustBoardForWordLength();
            saveGameState();
        }

        // Focus mobile input on small screens
        if (window.innerWidth <= 500) {
            mobileInput.focus();
            setTimeout(()=>document.getElementById(`row${currentRow}`)?.scrollIntoView({behavior:'smooth', block:'center'}),50);
        }
    });

    const pampBtn = createButton('PAMP GLABS', () => {
        window.open("https://www.jpg.store/collection/hoskycashgrab?tab=items&filters=eyJmdXIiOlsiR29sZUVuIExhYnJhZG9yIl19",'_blank');
    });

    container.appendChild(newWordBtn);
    container.appendChild(pampBtn);
    document.body.appendChild(container);
}

// --- SHOW LOSE BUTTONS AFTER RETURN ---
// Only show the correct buttons after returning or refreshing


// --- WIN BUTTONS (back button restore only) ---
// --- WIN BUTTONS ---
function addWinButtons() {
    // Remove existing buttons if any
    const existing = document.getElementById('win-buttons-container');
    if(existing) existing.remove();

    // Blur the keyboard/alphabet
    document.getElementById('alphabet').style.filter = 'blur(5px)';

    const container = document.createElement('div');
    container.id = 'win-buttons-container';
    container.style.position = 'fixed';
    container.style.bottom = '90px';
    container.style.left = '50%';
    container.style.transform = 'translateX(-50%)';
    container.style.display = 'flex';
    container.style.justifyContent = 'center';
    container.style.alignItems = 'center';
    container.style.gap = '20px';
    container.style.zIndex = '10005';
    container.style.flexWrap = 'wrap';

    function createButton(text, onClick) {
    const btn = document.createElement('button');
    btn.textContent = text;
    btn.style.fontFamily = 'GROBOLD, sans-serif';
    btn.style.fontSize = '16px';       // 25% smaller
    btn.style.padding = '12px 24px';   // 25% smaller
    btn.style.cursor = 'pointer';
    btn.style.borderRadius = '6px';
    btn.style.border = '2px solid #206cd2';
    btn.style.backgroundColor = '#ff7f00'; // orange base
    btn.style.color = 'black';
    btn.style.transition = 'all 0.2s ease';

    btn.addEventListener('mouseover', () => {
        btn.style.backgroundColor = '#206cd2'; // Hosky blue hover
        btn.style.color = 'black';
        btn.style.transform = 'scale(1.1)';    // slight pop
        btn.style.boxShadow = '0 0 15px #206cd2'; // subtle glow
    });

    btn.addEventListener('mouseout', () => {
        btn.style.backgroundColor = '#ff7f00'; // revert orange
        btn.style.color = 'black';
        btn.style.transform = 'scale(1)';
        btn.style.boxShadow = 'none';
    });

    btn.addEventListener('click', onClick);
    return btn;
}




    const newGameBtn = createButton('NEW HOSKY MODE GAME', () => {
        container.remove();
        currentRow = 0; currentCol = 0; gameOver = false;
        document.getElementById('win-message').style.display='none';
        // Remove blur from keyboard
        document.getElementById('alphabet').style.filter = 'none';
        setBlur(false); // optional, keeps game board clear

        for(let r=0;r<6;r++){
            const cells = document.getElementById(`row${r}`).querySelectorAll('.cell');
            cells.forEach(c=>{c.textContent=''; c.className='cell';});
        }
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l=>{
            const box = document.getElementById(`letter-${l}`);
            if(box){box.style.backgroundColor=''; box.style.color='#206cd2';}
        });
        saveGameState();
    });

    const pampGlabsBtn = createButton('PAMP GLABS', () => {
        window.open("https://www.jpg.store/collection/hoskycashgrab?tab=items&filters=eyJmdXIiOlsiR29sZUVuIExhYnJhZG9yIl19", '_blank');
    });

    container.appendChild(newGameBtn);
    container.appendChild(pampGlabsBtn);

    document.body.appendChild(container);
}






// Call this **only if the restored game was a win**
if(gameOver && document.getElementById('win-message').style.display==='block'){
    addWinButtons();
}


</script>
</body>
</html>
